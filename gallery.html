<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Our School Gallery</title>
  <link rel="icon" href="image/log.jpg" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="load.css">
  <link rel="stylesheet" href="gallery.css">
</head>
<body>

<!-- Header -->
<header id="mainHeader">
  <div class="logo">
    <img src="image/log.jpg" alt="School Logo" />
    <h1>College Adventiste de Gitwe</h1>
  </div>

  <div class="menu-toggle" onclick="toggleMenu()">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <nav id="navMenu">
    <a href="index.html">Home</a>
    <a href="academics.html">Academics</a>
    <div class="dropdown" id="ourSchoolDropdown">
      <button onclick="toggleDropdown()">Our School</button>
      <div class="dropdown-content" id="dropdownMenu">
        <a href="about.html">About Us</a>
        <a href="alumni.html">Alumni</a>
        <a href="gallery.html">Gallery</a>
      </div>
    </div>
    <a href="extracurricular.html">Extracurricular</a>
    <a href="updates.html">School Updates</a>
    <a href="#contact">Contacts</a>
    <a href="apply.html" class="apply-btn">Apply Online</a>
  </nav>
</header>

  <!-- Side-by-side Gallery & Videos -->
  <div class="gallery-video-wrapper">
    <!-- Gallery (Left) -->
    <div class="gallery-container left-side">
      <h1>Our School Gallery</h1>
      <p>Explore our school Gallery showcasing vibrant moments and student creativity.</p>
      <div class="gallery-grid" id="galleryGrid"></div>
      <button class="show-more-btn" id="showMoreImages">Show More</button>
    </div>

    <!-- Videos (Right) -->
    <div class="gallery-container right-side">
      <h1>Our School Videos</h1>
      <p>Watch our students in action ‚Äî from cultural events to tech demos, art showcases to science fairs.</p>
      <div class="video-grid" id="videoGrid"></div>
      <button class="show-more-btn" id="showMoreVideos">Show More</button>
    </div>
  </div>

  <!-- Full Image Overlay -->
  <div class="overlay" id="overlay">
    <button class="close-btn" onclick="closeImage()">Close</button>
    <img id="fullImage" src="" alt="Full View">
  </div>

   <!-- Footer -->
   <footer id="main-footer">
    <div class="footer-content">
      <div class="footer-column">
        <h3>SINCE 1931</h3>
        <p><strong>COLLEGE ADVENTISTE de GITWE</strong></p>
        <p>Gitwe Hill, Ruhango</p>
        <p>PO Box 85, Muhanga, Rwanda</p>
      </div>
      <div class="footer-column">
        <h4>INQUIRIES</h4>
        <p><strong>Admissions:</strong> admissions@auca.ac.rw<br>üìû +250 7800000000</p>
        <p><strong>Media:</strong> gitweadventistcollege@gmail.com</p>
        <p><strong>General:</strong> info@gitwe.ac.rw</p>
      </div>
      <div class="footer-column">
        <h4>Quick Links</h4>
        <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
        <h4>Follow Us</h4>
        <p>üåê Facebook | Twitter | YouTube</p>
      </div>
    </div>

    <div id="map-container">
      <h2>Our Location</h2>
      <p>Find us here:</p>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1231.5078155214774!2d29.686978497943226!3d-2.2409156847549685!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x19c33129d1f4a9a3%3A0xf781d00ae8a23457!2sGitwe%20Adventist%20College!5e1!3m2!1sen!2srw!4v1759236603327!5m2!1sen!2srw" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>

    <div class="footer-bottom">
      <p class="location-blink">üìç Gitwe Hill, Ruhango | PO Box 85, Muhanga, Rwanda</p>
      <p class="copyright">
        ¬© <span id="copy-year">2025</span> All rights reserved.
        <br> Designed and developed by <strong>C.A.G</strong>.
      </p>
    </div>
  </footer>

  <script src="main.js"></script>
  <script src="gallery.js"></script>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOJTxkB5AIQcC_Kdoci7aVgUJ8aoqFbfA",
      authDomain: "gitweadventistcollege-43898.firebaseapp.com",
      databaseURL: "https://gitweadventistcollege-43898-default-rtdb.firebaseio.com",
      projectId: "gitweadventistcollege-43898",
      storageBucket: "gitweadventistcollege-43898.firebasestorage.app",
      messagingSenderId: "666797850535",
      appId: "1:666797850535:web:f161deee2c262912668082",
      measurementId: "G-7C00X575VD"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const galleryGrid = document.getElementById("galleryGrid");
    const videoGrid = document.getElementById("videoGrid");

    // -----------------
    // Helper to normalize YouTube URLs
    // -----------------
    function normalizeYouTubeUrl(url) {
      let videoId = "";

      if (url.includes("watch?v=")) {
        videoId = url.split("watch?v=")[1].split("&")[0];
      } else if (url.includes("youtu.be/")) {
        videoId = url.split("youtu.be/")[1].split("?")[0];
      } else if (url.includes("embed/")) {
        videoId = url.split("embed/")[1].split("?")[0];
      }

      if (!videoId) return null;
      return `https://www.youtube.com/embed/${videoId}`;
    }

    // -----------------
    // Load Images
    // -----------------
    onValue(ref(db, "gallery/images"), (snapshot) => {
      galleryGrid.innerHTML = "";
      let images = [];
      snapshot.forEach((child) => {
        images.push(child.val());
      });

      // Sort newest first
      images.sort((a, b) => b.timestamp - a.timestamp);

      images.forEach((data) => {
        const img = document.createElement("img");
        img.src = data.url;
        img.alt = data.caption || "Gallery Image";
        img.onclick = () => openImage(img);
        galleryGrid.appendChild(img);
      });

      setupShowMore("galleryGrid", "showMoreImages", 10);
    });

    // -----------------
    // Load Videos
    // -----------------
    onValue(ref(db, "gallery/videos"), (snapshot) => {
      videoGrid.innerHTML = "";
      let videos = [];
      snapshot.forEach((child) => {
        videos.push(child.val());
      });

      // Sort newest first
      videos.sort((a, b) => b.timestamp - a.timestamp);

      videos.forEach(({ url, title }) => {
        const embedUrl = normalizeYouTubeUrl(url);

        if (!embedUrl) {
          console.warn("Skipping invalid YouTube URL:", url);
          return;
        }

        const card = document.createElement("div");
        card.className = "video-card";
        card.innerHTML = `
          <iframe src="${embedUrl}"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
          ${title ? `<p>${title}</p>` : ""}
        `;
        videoGrid.appendChild(card);
      });

      setupShowMore("videoGrid", "showMoreVideos", 5);
    });

    // -----------------
    // Image Overlay
    // -----------------
    window.openImage = function(img) {
      const overlay = document.getElementById("overlay");
      const fullImage = document.getElementById("fullImage");
      fullImage.src = img.src;
      overlay.classList.add("active");
    };
    window.closeImage = function() {
      document.getElementById("overlay").classList.remove("active");
    };

    // -----------------
    // Show More logic
    // -----------------
    function setupShowMore(containerId, buttonId, maxItems) {
      const container = document.getElementById(containerId);
      const button = document.getElementById(buttonId);
      const items = Array.from(container.children);

      if (items.length <= maxItems) {
        button.style.display = "none"; // hide button if not needed
        return;
      }

      items.slice(maxItems).forEach(item => item.classList.add("hidden"));

      button.onclick = () => {
        const hiddenItems = container.querySelectorAll(".hidden");
        if (hiddenItems.length) {
          hiddenItems.forEach(el => el.classList.remove("hidden"));
          button.textContent = "Show Less";
        } else {
          items.slice(maxItems).forEach(item => item.classList.add("hidden"));
          button.textContent = "Show More";
          container.scrollIntoView({ behavior: "smooth" });
        }
      };
    }
  </script>
</body>
</html>
